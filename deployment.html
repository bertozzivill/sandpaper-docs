<!-- START: inst/pkgdown/templates/layout.html -->
<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <!-- START: inst/pkgdown/templates/head.html -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta http-equiv="last-modified" content="2021-08-14 00:24:31 +0000">



<title>Introduction to the New Lesson Template: Lesson Deployment</title>

<link rel="apple-touch-icon-precomposed" sizes="57x57" href="favicons/cp/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="favicons/cp/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="favicons/cp/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="favicons/cp/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="favicons/cp/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="favicons/cp/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="favicons/cp/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="favicons/cp/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="favicons/cp/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="favicons/cp/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="favicons/cp/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="favicons/cp/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="favicons/cp/favicon-128.png" sizes="128x128" />

<meta name="application-name" content="The Carpentries - Introduction to the New Lesson Template"/>

<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="favicons/cp/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="favicons/cp/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="favicons/cp/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="favicons/cp/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="favicons/cp/mstile-310x310.png" />



<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>

<!--carpentries-->
<link href="css/syntax.css" rel="stylesheet">
<link href="css/lesson.css" rel="stylesheet">
<script src="js/lesson.js"></script>




<meta property="og:title" content="Lesson Deployment" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- END:   inst/pkgdown/templates/head.html-->

  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-title-body">
      <header>
      <!-- START: inst/pkgdown/templates/navbar.html -->
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">Home</a>
        <!-- TODO: the logo is not centered in the nav bar and looks ugly... also there needs to be a better way of choosing the logo... probably on the R side.-->
        <a href="https://carpentries.org" class="pull-left">
          <img class="navbar-logo" src="img/cp-icon-blue.svg" alt="The Carpentries logo" />
        </a>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="CODE_OF_CONDUCT.html">Code of Conduct</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Episodes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="introduction.html">Introduction to the New Template</a>
    </li>
    <li>
      <a href="episodes.html">Episode Structure</a>
    </li>
    <li>
      <a href="editing.html">Editing a {sandpaper} lesson</a>
    </li>
    <li>
      <a href="example.html">EXAMPLE: Using RMarkdown</a>
    </li>
    <li>
      <a href="deployment.html">Lesson Deployment</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    For Learners
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="setup.html">Setup</a>
    </li>
    <li>
      <a href="github-pat.html">Setting Up a Personal Access Token via R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    For Instructors
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="notes.html">Instructor Notes</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Learner Profiles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="maintainer.html">Maintainer Profiles</a>
    </li>
    <li>
      <a href="instructor.html">Instructor Profiles</a>
    </li>
  </ul>
</li>
<li>
  <a href="LICENSE.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

      <!--START: inst/pkgdown/templates/header.html-->


    <div class="panel panel-default life-cycle">
      <div id="life-cycle" class="panel-body pre-alpha">
         This lesson is still being designed and assembled (Pre-Alpha version) 
        
        
      </div>
    </div>


<!--END  : inst/pkgdown/templates/header.html-->

      </header>

<!-- START: inst/pkgdown/templates/content-title-body.html -->
<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Lesson Deployment</h1>
    </div>

<div class="section level2 objectives">
<h2>Overview</h2>
<div class="row">
<div class="col-md-3">
<p><strong>Teaching: </strong> 5<br />
<strong>Exercises: </strong> 0</p>
</div>
<div class="col-md-9">
<p><strong>Questions</strong></p>
<ul>
<li>What is the two-step model of deployment?</li>
<li>How do we use the two-step model to provide PR audits?</li>
</ul>
</div>
</div>
<div class="row">
<div class="col-md-3">

</div>
<div class="col-md-9">
<p><strong>Objectives</strong></p>
<ul>
<li>Understand the two-step model for lesson deployment</li>
<li>Understand the Pull Request Preview for generated lesson content</li>
</ul>
</div>
</div>
</div>
<div id="how-we-got-here" class="section level2">
<h2>How we got here</h2>
<p>Since 2016, <a href="https://software-carpentry.org/blog/2016/07/rmarkdown-new-template.html">we have supported using RMarkdown in lessons</a>. The benefits have been that authors no longer need to manually copy and paste output and graphs into their documents. We were even able to use continuous integration to build the RMarkdown documents to markdown so that they would be then deployed using Jekyll.</p>
<p>The downside to this model was that the maintainers would occasionally encounter unexpected outputs from new contributions because there was either a syntax error or <a href="https://carpentries.org/blog/2020/08/r-4-migration/">the R ecosystem had changed paradigms</a>. Moreover, people would often edit the generated markdown file instead of the source RMarkdown file, which would result in progress being lost because of a regenerated file.</p>
</div>
<div id="the-two-step-model-of-deployment" class="section level2">
<h2>The two-step model of deployment</h2>
<p>To alleviate the downsides of working with generated content, the new template employs a two-step model of deployment when you run <code>sandpaper::build_lesson()</code></p>
<ol style="list-style-type: decimal">
<li>Take any source files with content that needs to be interpreted (e.g.  RMarkdown and in the future Jupyter Notebooks) and <strong>render them to markdown</strong> in a staging area ignored by git.</li>
<li>Apply the HTML style to the markdown files in the staging area to create the lesson website.</li>
</ol>
<div class="figure">
<img src="https://zkamvar.github.io/stunning-barnacle/img/local-flow.dot.svg" alt="Diagram showing the process of `build_lesson(rebuild = TRUE)`, starting from R Markdown to Markdown and finally to HTML. R Markdown is highlighted as being the only element tracked by git." alt="" />
<p class="caption">The two-step model of lesson deployment</p>
</div>
<p>All of the generated content lives in the <code>site/</code> folder, and importantly: it is all cached and ignored by git. Ignoring generated content locally means that the source of truth for these files is no longer dependent on the maintainer’s local setup.</p>
<p>The reason we have this model is also for portability. It’s because markdown output is a lot easier to audit than HTML when something goes wrong, rendered markdown can be transferred to other contexts (e.g. books or blogposts), and we can swap out the generators without needing to rewrite the entire pipeline.</p>
<aside class="callout">
<div id="did-you-know" class="section level3">
<h3>Did you know?</h3>
<p>When the lesson is pushed to GitHub, all of the generated content IS stored in separate branches so that we can provide a way for you to audit changes from pull requests.</p>
</div>
</aside>
</div>
<div id="on-github" class="section level2">
<h2>On GitHub</h2>
<p>On GitHub, we store generated content in two orphan branches called <code>md-outputs</code> and <code>gh-pages</code> for the generated markdown and html, respectively. We use [GitHub Actions Workflows][gh-workflow] to build, validate, and deploy our lessons on GitHub pages. If you use pure markdown lessons, you should notice no significant changes to your workflow.</p>
<p>These workflows are the source of truth for the lessons and will keep your lesson up-to-date with the latest version of the HTML template.</p>
<p>If you use RMarkdown lessons, you will notice that for every pull request, a GitHub bot comments on your pull requests informing you about what content has changed and gives you a link to the differences between the current state of the <code>md-outputs</code> branch and the proposed changes.</p>
<p>The controls for these actions live in the <code>.github/</code> folder of your repository and are currently maintained at <a href="https://github.com/zkamvar/actions/tree/main/workflows#readme" class="uri">https://github.com/zkamvar/actions/tree/main/workflows#readme</a>.</p>
<aside class="callout">
<div id="risk-management" class="section level3">
<h3>Risk Management</h3>
<p>Accepting generated content into lessons from anyone runs the risk of a security breach by exposing secrets. To mitigate this risk, GitHub limits the scope of what is possible inside a pull request so that we can check and render the content without risk of exploitation. Through this, we render and check the lesson inside the pull request with no privileges, check that the pull request is valid (not malicious), and then create a temporary branch for an exploratory preview, allowing the maintainer to audit the generated content before it gets adopted into the curriculum.</p>
<p>If the PR is invalid (e.g. the contributor spoofed a separate, valid PR, or modified one of the github actions files), then the maintainer is alerted that the PR is potentially risky.</p>
<div class="figure">
<img src="https://raw.githubusercontent.com/zkamvar/stunning-barnacle/main/img/pr-flow.dot.svg" alt="Workflow diagram from a pull request starting from Pull Request, and going to a path involving validation, artifact creation, maintainer review, and potential deployment." alt="" />
<p class="caption">The pull request cycle. Ellipse nodes (Pull Request and Maintainer Review) are the only places that require maintainer attention.</p>
</div>
</div>
</aside>
</div>
<div id="updating-your-workflows" class="section level2">
<h2>Updating Your Workflows</h2>
<p>The workflows are one of the few points in the new template where it needs to be updated manually.</p>
<aside class="callout">
<div id="in-the-future" class="section level3">
<h3><span class="emoji" data-emoji="crystal_ball">🔮</span> In the future</h3>
<p>In the future, we will make this process easier by creating bots that will periodically provide pull requests that update these workflows.</p>
</div>
</aside>
<p>To update your workflows, you can use the following command in your lesson:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>sandpaper<span class="sc">::</span><span class="fu">fetch_github_workflows</span>()</span></code></pre></div>
<p>After that, you can add and commit your changes and then push them to GitHub.</p>
</div>
<div class="section level2 keypoints">
<h2>Keypoints</h2>
<ul>
<li>Lessons are built using a two-step process of caching markdown outputs and then building HTML from that cache</li>
<li>We use GitHub Actions to deploy and audit generated lesson content to their websites</li>
</ul>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>

</div>


<!-- END:   inst/pkgdown/templates/content-title-body.html-->


      <footer>
      <!-- START: inst/pkgdown/templates/footer.html -->
<div class="container">
  <div class="row">
    <div class="col-xs-1">
      <h3 class="text-left">
        <a href="example.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      </h3>
    </div>
    <div class="col-xs-10">
      <h3 class="maintitle"><a href="index.html">Introduction to the New Lesson Template</a></h3>
    </div>
    <div class="col-xs-1">
      <h3 class="text-right">
        <a href="index.html"><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      </h3>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 copyright" align="left">
      Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC-BY 4.0</a> 2018–2021
      by <a href="https://carpentries.org">The Carpentries</a>
      <br>
      Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC-BY 4.0</a> 2016–2018
      by <a href="https://softwarecarpentry.org">Software Carpentry Foundation</a>
    </div>
    <div class="col-md-6 help-links pull-right" align="right">
      <a href="https://github.com/carpentries/sandpaper-docs//edit/main/episodes/deployment.md" data-checker-ignore>Edit on GitHub</a>
      /
      <a href="https://github.com/carpentries/sandpaper-docs//blob/main/CONTRIBUTING.md" data-checker-ignore>Contributing</a>
      /
      <a href="https://github.com/carpentries/sandpaper-docs//">Source</a>
      /
      <a href="https://github.com/carpentries/sandpaper-docs//blob/main/CITATION" data-checker-ignore>Cite</a>
      /
      <a href="mailto:zkamvar@carpentries.org">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/zkamvar/sandpaper">{sandpaper}</a>
      and <a href="https://github.com/zkamvar/varnish">{varnish}</a>.
    </div>
  </div>
</div>
<!-- END:   inst/pkgdown/templates/footer.html-->

      </footer>
   </div>

  <!-- START: inst/pkgdown/templates/docsearch.html -->

<!-- END:   inst/pkgdown/templates/docsearch.html-->


  </body>
</html>

<!-- END:   inst/pkgdown/templates/layout.html-->

